
    <style>
        main {
            padding: 0px !important;
        }
    </style>
    <div style="width: 100vw; height: 100vh; position: relative;">
        <div id="Summary">
            <a href="/identities">
                <div class="totals">
                    <label>Identities</label>
                    <div id="IdCount" class="total">0</div>
                </div>
            </a>
            <a href="/edge-services">
                <div class="totals">
                    <label>Services</label>
                    <div id="ServiceCount" class="total">0</div>
                </div>
            </a>
            <div class="totals">
                <label>Authenticators</label>
                <div id="AuthCount" class="total">0</div>
            </div>
            <a href="/configs">
                <div class="totals">
                    <label>Configurations</label>
                    <div id="ConfigCount" class="total">0</div>
                </div>
            </a>
            <a href="/service-policies">
                <div class="totals">
                    <label>Policies</label>
                    <div id="PolicyCount" class="total">0</div>
                </div>
            </a>
            <div class="totals">
                <label>Sessions</label>
                <div id="SessionCount" class="total">0</div>
            </div>
        </div>
        <div id="MainMap"></div>
    </div>

    <script language="javascript" type="text/javascript">
        page = {
            map: null,
            binding: {
                pageTitle: "Dashboard",
                singular: "Dashboard"
            },
            data: [],
            idsObject: null,
            init: function() {
                page.idsObject = new Data("identities");

                page.events();

                page.idsObject.init(true);
                summary.get();
                
                page.map = L.map("MainMap", {zoomControl: false});
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {attribution: '&copy; NetFoundry Inc.'}).addTo(page.map);
            }, 
            events: function() {
                context.addListener(page.idsObject.name, page.idsLoaded);
                context.addListener(summary.name, page.getLoaded);
            },
            getLoaded: function(e) {
                page.data = context.get(summary.name);
                $("#IdCount").html(page.data.identities);
                $("#ServiceCount").html(page.data.services);
                $("#AuthCount").html(page.data.autheticators);
                $("#ConfigCount").html(page.data.configs);
                $("#PolicyCount").html(page.data.servicePolicies+page.data.edgeRouterPolicies+page.data.serviceEdgeRouterPolicies);
                $("#SessionCount").html(page.data.sessions);
            },
            idsLoaded: function(e) {
                var index = 0;
                for (var i=0; i<page.idsObject.data.length; i++) {
                    if (page.idsObject.data[i].tags&&page.idsObject.data[i].tags.geolocation&&page.idsObject.data[i].tags.geolocation.split(',').length==2) {
                        var items = page.idsObject.data[i].tags.geolocation.split(',');
                        if (!isNaN(items[0])&&!isNaN(items[1])) {
                            if (index==0) {
                                page.map.setView([items[0], items[1]], 10);
                                index++;
                            }
                            L.marker([items[0], items[1]]).addTo(page.map).bindPopup(page.idsObject.data[i].name).openPopup();
                        }
                    }
                }
                if (index==0) {
                    page.map.setView(new L.LatLng(41.850033, -87.6500523), 4);
                }
                setTimeout(function() {page.map.invalidateSize();}, 1000);   
            }
        }
    </script>